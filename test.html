<!doctype html>
<html>
	<head>
		<title>Daisy Editor</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
		<script type="text/javascript" src="js/jquery-1.5.1.js"></script>
		<script type="text/javascript" src="js/js-printf.js"></script>

		<script type="text/javascript">
			$.log = function(msg) {
				if( typeof console !== 'undefined')
					console.log(msg);
			}
			$.inherit = function(inheritClass, baseClass) {
				//首先把父类的prototype中的函数继承到子类中
				for(var pFunc in baseClass.prototype) {
					var sp = inheritClass.prototype[pFunc];
					//如果子类中没有这个函数，添加
					if( typeof sp === 'undefined') {
						inheritClass.prototype[pFunc] = baseClass.prototype[pFunc];
					}
					//如果子类已经有这个函数，则忽略。以后可使用下面的callBase函数调用父类的方法

				}
				//保存继承树，当有多级继承时要借住继承树对父类进行访问
				inheritClass.__base_objects__ = new Array();
				inheritClass.__base_objects__.push(baseClass);

				if( typeof baseClass.__base_objects__ !== 'undefined') {
					for(var i = 0; i < baseClass.__base_objects__.length; i++)
						inheritClass.__base_objects__.push(baseClass.__base_objects__[i]);
				}

				/**
				 * 执行父类构造函数，相当于java中的this.super()
				 * 不使用super是因为super是ECMAScript保留关键字.
				 * @param {arguments} args 参数，可以不提供
				 */
				inheritClass.prototype.base = function(args) {

					var baseClass = null, rtn = undefined;
					if( typeof this.__inherit_deep__ === 'undefined') {
						this.__inherit_deep__ = 0;
					} else {
						this.__inherit_deep__++;
						//$.dprint("d+:"+this.__inherit_deep__);
					}

					baseClass = inheritClass.__base_objects__[this.__inherit_deep__];

					if( typeof args === "undefined" || args == null) {
						rtn = baseClass.call(this);
					} else if( args instanceof Array === true) {
						rtn = baseClass.apply(this, args);
					} else {
						var _args = new Array();
						for(var i = 0; i < arguments.length; i++)
							_args.push(arguments[i]);
						rtn = baseClass.apply(this, _args);
					}

					this.__inherit_deep__--;

					//$.dprint("d-:"+this.__inherit_deep__);
					return rtn;
				}
				/**
				 * 给继承的子类添加调用父函数的方法
				 * @param {arguments} args 参数，可以不提供
				 */
				inheritClass.prototype.callBase = function(args) {
					//firefox bug fix
					arguments;
					
					var baseClass = null, rtn = undefined;

					if( typeof this.__inherit_deep__ === 'undefined') {
						this.__inherit_deep__ = 0;

					} else {
						this.__inherit_deep__++;
						//$.dprint("d+:"+this.__inherit_deep__);
					}

					//$.dprint(this.__inherit_deep__);
					baseClass = inheritClass.__base_objects__[this.__inherit_deep__];
					$.log(inheritClass.prototype.callBase.caller)
					var med = baseClass.prototype[inheritClass.prototype.callBase.caller.name];
					if( typeof med === 'function') {
						if( typeof args === "undefined" || args === null) {
							rtn = med.call(this);
						} else if( args instanceof Array === true) {
							rtn = med.apply(this, args);
						} else {
							rtn = med.apply(this, arguments);
						}
					} else {
						throw "There is no method:" + method + " in baseClass";
					}

					this.__inherit_deep__--;

					//$.dprint("d-:"+this.__inherit_deep__);
					//$.dprint("----");
					return rtn;
				}
			}
			
			var A = function(name){
				this.name = name;
			}
			A.prototype = {
				say : function(msg){
					alert(name + " says: " + msg);
				}
			}
			
			var B = function(name,age){
				this.base(name);
				this.age = age;
			}
			B.prototype = {
				say : function(msg){
					this.callBase(msg);
					alert("my age: "+this.age);
				}
			}
			$.inherit(B,A);
			
			var C = function(){
				this.base("daisy",22);
			}
			C.prototype = {
				say : function(){
					this.callBase("I Love Daisy.");
				}
			}
			$.inherit(C,B);
			
			function T1(){
				this.t = 123;
			}
			T1.prototype = {
				f : function(){
					arguments;
					$.log(this.t)
					$.log(arguments.callee.caller);
					$.log(T1.prototype.f.caller.caller)
				}
			}
			
			function T2(){
				
			}
			T2.prototype = {
				f2 : function(){
					new T1().f(1,2,3);
				}
			}
			function do_test() {
				new T2().f2(1,2,3)
				//new C().say();
			}
		</script>
	</head>
	<body>
		
		<div>
			<input type="button" value="test" id="btn-test" onclick="do_test();"/>
		</div>
		
	</body>
</html>