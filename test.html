<!doctype html>
<html>
	<head>
		<title>Daisy Editor</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
		<script type="text/javascript" src="js/jquery-1.5.1.js"></script>
		<script type="text/javascript" src="js/js-printf.js"></script>

		<script type="text/javascript">
			$.log = function(msg) {
				if( typeof console !== 'undefined')
					console.log(msg);
			}
			function do_test(e) {
				search("一览");
				search("一览无遗");
			}

			function kmp_next(str) {
				var len = str.length, n_arr = new Array(len);
				if(len === 0)
					return n_arr;
				n_arr[0] = -1;
				for(var i = 1; i < len; i++) {
					var j = i - 1;
					while(n_arr[j] >= 0 && str[i] !== str[n_arr[j]]) {
						j = n_arr[j] - 1;
					}
					n_arr[i] = n_arr[j] + 1;
				}
				return n_arr;
			}

			function kmp_search(src, dst) {
				var s_l = src.length, d_l = dst.length;
				if(s_l === 0)
					return -1;
				if(d_l === 0)
					return 0;
				var d_next = kmp_next(dst), idx = 0;
				for(var i = 0; i < s_l; i++) {
					while(true) {
						if(src[i] === dst[idx]) {
							idx++;
							if(idx === d_l) {
								return i - idx + 1;
							}
							break;
						} else if(idx === 0) {
							break;
						} else {
							idx = d_next[idx];
						}
					}
				}
				return -1;
			}

			function deal_keydown(e) {
				$.log(e.keyCode);
			}

			var w_trie = {};

			function search(d) {
				var t = w_trie;
				for(var i = 0; i < d.length; i++) {
					if(t[d[i]] == null && t[''] == null) {
						console.log("not found");
						return;
					} else {
						t = t[d[i]];
					}
				}
				if(t[''] == null) {
					console.log("not found.");
				} else {
					console.log("found.");
				}

			}

			$(function() {
				$.get("chinese/dict.txt", function(data) {
					(function() {

						var txt = data, idx = 0;
						function _insert(t, word) {
							for(var i = 0; i < word.length; i++) {
								var c = word[i];
								t[c] = t[c] == null ? {} : t[c];
								t = t[c];
							}
							t[''] = 1;
						}

						function read_num() {
							return txt.charCodeAt(idx++);
						}

						function read_word(length) {
							if(length == null)
								length = 1;
							var w = txt.substr(idx, length);
							idx += length;
							return w;
						}

						var c_num = read_num();
						//console.log("char number: "+c_num);
						for(var i = 0; i < 8; i++) {
							var w_chr = read_word(1), count = read_num(), t = w_trie[w_chr] = {};

							for(var j = 1; j <= count; j++) {
								var w_num = read_num();
								//console.log("w_num:"+w_num);
								for(var x = 0; x < w_num; x++) {
									_insert(t, read_word(j));
								}
							}
						}

					})();
				});
			})
			function e_com(e) {
				$.log(e)
			}

		</script>
	</head>
	<body>
		<div contenteditable="true">
			<p>
				Hello World
			</p>
		</div>
		<div ondblclick="dbl_test(event);">
			<textarea id="txtbox" type="text" value="更重要强大" ></textarea>
			<br/>
			<input type="button" value="test" id="btn-test" onclick="do_test();"/>
			<br/>
			<div>
				hello world.4323.3ad_a 葛羽航你好   da ^#@.
			</div>
		</div>
		<div>
			<canvas style="border:1px solid blue;" id="c_test"></canvas>
		</div>
	</body>
</html>